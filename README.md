# Векторный поиск подходящих чанков

## Описание

Сервис для интеллектуального поиска релевантных фрагментов информации из базы знаний. Система использует гибридный подход, основанный на принципе Парето, предполагая, что 80% вопросов клиентов могут быть отвечены с использованием 20% разновидностей ответов. Сервис сначала проверяет соответствие запроса с тренировочной выборкой, и если совпадение недостаточное, переходит к сравнению с заголовками и чанками по косинусной мере сходства.

## Процесс поиска чанков

1. Сервис получает входящий запрос пользователя
2. Выполняется двухэтапный процесс поиска:
   - Проверка соответствия запроса с тренировочной выборкой с помощью BERT (порог 80%)
   - При недостаточном соответствии - сравнение вопроса с заголовками и чанками по косинусной мере
   - Комбинирование скоров из BERT и TF-IDF для получения итогового результата
3. Возврат топ-1, топ-3 или топ-5 наиболее релевантных чанков

## Технологии

- Python 3.x
- FastAPI - для создания REST API
- BERT - для семантического сравнения текстов
- TF-IDF - для векторизации текстовых данных
- Косинусное сходство - для определения близости векторов
- Векторные представления - для эффективного поиска

## Структура проекта

```
.
├── chunk_finder.py               # Класс ChunkFinder для создания и работы с моделью
├── app_run.py                    # FastAPI приложение для предсказания
├── vector_search.ipynb           # Подробный разбор подходов и тесты
├── examples/                     # Примеры для обращения по API
└── README.md                     # Документация проекта
```

## Основные принципы реализации

1. **Принцип Парето (80/20)**: Предположение, что 80% вопросов клиентов могут быть отвечены с использованием 20% разновидностей ответов
2. **Гибридный подход**:
   - Быстрая проверка соответствия с тренировочной выборкой (BERT)
   - Углубленный анализ с использованием векторных представлений (TF-IDF)
3. **Ранжирование результатов**: Объединение скоров разных методов для получения наиболее релевантных ответов

## API Endpoints

### POST /predict

Находит наиболее релевантные чанки для заданного запроса.

**Пример запроса:**

```json
{
  "query": "Как оформить возврат товара?",
  "top_k": 3
}
```

**Пример ответа:**

```json
{
  "status": "success",
  "top_chunks": [
    {
      "chunk_id": 142,
      "title": "Возврат товара",
      "chunk_text": "Для оформления возврата товара необходимо...",
      "relevance_score": 0.92
    },
    {
      "chunk_id": 156,
      "title": "Процедура возврата",
      "chunk_text": "Возврат товара осуществляется в течение 14 дней...",
      "relevance_score": 0.85
    },
    {
      "chunk_id": 189,
      "title": "Документы для возврата",
      "chunk_text": "При возврате товара необходимо предоставить...",
      "relevance_score": 0.79
    }
  ]
}
```
